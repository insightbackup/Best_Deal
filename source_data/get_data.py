import requests
import gzip
import s3fs


def cities_info():
    return {
        'antwerp': ('belgium/vlg',
                    ['2019-07-21', '2019-06-25', '2019-05-23', '2019-04-20', '2019-03-19', '2019-02-13',
                     '2019-01-22',
                     '2018-12-15', '2018-11-18', '2018-10-16', '2018-09-15', '2018-08-19', '2018-07-28',
                     '2018-05-22',
                     '2018-04-17', '2017-05-12', '2015-10-03']),
        'asheville': ('united-states/nc',
                      ["2019-07-25", "2019-06-26", "2019-05-26", "2019-04-23", "2019-03-25", "2019-02-17",
                       "2019-01-27",
                       "2018-12-16", "2018-11-20", "2018-10-17", "2018-09-16", "2018-08-21", "2018-07-29",
                       "2018-04-18",
                       "2016-04-18"]),
        'athens': ('greece/attica',
                   ['2019-07-13', '2019-06-10', '2019-05-15', '2019-04-13', '2019-03-11', '2019-02-08', '2019-02-08',
                    '2018-12-12', '2018-11-15', '2018-10-11', '2018-09-13', '2018-08-15', '2018-07-16',
                    '2018-05-16', '2018-04-14', '2017-05-09', '2015-07-17']),
        'barcelona': ('spain/catalonia',
                      ['2019-07-10', '2019-06-07', '2019-05-14', '2019-04-10', '2019-03-08', '2019-02-06',
                       '2019-01-14',
                       '2018-12-10', '2018-11-07', '2018-10-10', '2018-09-11',
                       '2018-08-14', '2018-07-10', '2018-06-09',
                       '2018-05-14', '2018-04-12', '2018-02-07', '2018-01-17', '2017-12-09', '2017-11-13',
                       '2017-10-07',
                       '2017-09-12', '2017-08-06', '2017-07-06', '2017-06-05', '2017-05-07', '2017-04-08',
                       '2017-03-06',
                       '2017-02-09', '2017-01-04', '2016-12-08', '2016-11-07',
                       '2016-01-03', '2015-10-02', '2015-09-04', '2015-07-17', '2015-04-30']),
        'barossa-valley': ('australia/sa',
                           ['2019-07-15', '2019-06-22', '2019-05-22', '2019-04-17', '2019-03-13', '2019-02-11',
                            '2019-01-19', '2018-12-14', '2018-11-15', '2018-10-16', '2018-09-15', '2018-08-18',
                            '2018-07-24',
                            '2018-05-21', '2018-04-16']),
        'barwon-south-west-vic': ('australia/vic',
                                  ['2019-08-28', '2019-07-20', '2019-06-25', '2019-05-23', '2019-04-20', '2019-03-18',
                                   '2019-02-13', '2019-01-27', '2018-12-16', '2018-11-18', '2018-10-25', '2018-09-10',
                                   '2018-08-06']),
        'bergamo': ('italy/lombardia',
                    ['2019-07-29', '2019-06-30', '2019-05-30', '2019-04-29', '2019-03-30', '2019-02-18', '2019-01-30',
                     '2018-12-21', '2018-11-26', '2018-10-18', '2018-09-22', '2018-08-28', '2018-07-31', '2018-04-21']),
        'berlin': ('germany/be',
                   ['2019-07-11', '2019-06-08', '2019-05-14', '2019-04-11', '2019-03-08', '2019-02-06', '2019-01-14',
                    '2018-12-10', '2018-11-07', '2018-10-10', '2018-09-12', '2018-08-14', '2018-07-10', '2018-06-09',
                    '2018-05-14', '2018-04-12', '2017-05-08', '2017-04-08', '2017-03-06', '2017-02-10', '2017-01-06',
                    '2016-12-08', '2016-11-07', '2016-10-04', '2016-09-05', '2016-08-04', '2016-07-05', '2016-06-03',
                    '2016-05-03', '2016-04-04',
                    '2016-02-04',
                    '2016-01-04', '2015-12-05', '2015-11-08', '2015-10-03']),
        'bologna': ('italy/emilia-romagna',
                    ['2019-07-13', '2019-06-08', '2019-05-14', '2019-04-11', '2019-03-08', '2019-02-07', '2019-01-16',
                     '2018-12-11', '2018-11-12', '2018-10-10', '2018-09-29', '2018-08-28', '2018-07-31',
                     '2018-06-30']),
        'bordeaux': ('france/nouvelle-aquitaine',
                     ['2019-08-27', '2019-07-17', '2019-06-24', '2019-05-23', '2019-04-18', '2019-03-15', '2019-02-12',
                      '2019-01-22', '2018-12-15', '2018-11-18', '2018-10-16', '2018-09-15', '2018-08-19', '2018-07-25',
                      '2018-06-20', '2018-05-21', '2018-04-17']),
        'bristol': ('united-kingdom/england',
                    ['2019-07-14', '2019-06-14', '2019-05-19', '2019-04-15', '2019-03-12', '2019-02-09', '2019-01-17',
                     '2018-12-13', '2018-11-17', '2018-10-11', '2018-09-14', '2018-08-17', '2018-07-18', '2018-05-17',
                     '2018-04-14']),
        'brussels': ('belgium/bru',
                     ['2019-07-13', '2019-06-10', '2019-05-14', '2019-04-13', '2019-03-11', '2019-02-08', '2019-01-16',
                      '2018-12-12', '2018-11-12', '2018-10-10', '2018-09-13', '2018-08-15', '2018-07-11', '2018-05-16',
                      '2018-04-14', '2017-05-09', '2015-10-03']),
        'copenhagen': ('denmark/hovedstaden',
                       ['2019-07-25', '2019-06-27', '2019-05-27', '2019-04-24', '2019-03-26', '2019-02-17',
                        '2019-01-28', '2018-12-18', '2018-11-20', '2018-10-17', '2018-09-18', '2018-08-21',
                        '2018-07-29', '2018-04-18', '2017-06-15', '2016-06-28']),
        'crete': ('greece/crete',
                  ['2019-07-23', '2019-06-26', '2019-05-25', '2019-04-23', '2019-03-23']),
        'dublin': ('ireland/leinster',
                   ['2019-07-21', '2019-06-25', '2019-05-24', '2019-04-20', '2019-03-19', '2019-02-13', '2019-01-22',
                    '2018-12-16',
                    '2018-11-18', '2018-10-16', '2018-09-16', '2018-08-19', '2018-07-28', '2018-05-22', '2018-04-17',
                    '2017-02-18', '2016-08-07', '2016-01-06']),
        'edinburgh': ('united-kingdom/scotland',
                      ['2019-07-21', '2019-06-25', '2019-05-24', '2019-04-21', '2019-03-19', '2019-02-13', '2019-01-23',
                       '2018-12-16', '2018-11-18', '2018-10-16', '2018-09-14', '2018-08-20', '2018-07-28', '2017-09-18',
                       '2017-08-14', '2017-07-14', '2017-06-13', '2017-05-12', '2017-04-14', '2017-03-14', '2017-02-18',
                       '2017-01-14', '2016-07-09']),
        'euskadi': ('spain/pv',
                    ['2019-08-31', '2019-07-29', '2019-06-30', '2019-05-29', '2019-04-29', '2019-03-30', '2019-02-19',
                     '2019-01-30', '2018-12-22', '2018-11-26', '2018-10-20', '2018-09-27', '2018-08-28', '2018-07-31',
                     '2018-04-21']),
        'florence': ('italy/toscana',
                     ['2019-06-22', '2019-05-21', '2019-04-17', '2019-03-13', '2019-02-11', '2019-01-19',
                      '2018-12-14',
                      '2018-11-15', '2018-10-16', '2018-09-14', '2018-08-18', '2018-07-13', '2018-06-18', '2018-05-18',
                      '2018-04-16']),
        'geneva': ('switzerland/geneva',
                   ['2019-08-29', '2019-07-22', '2019-06-25', '2019-05-25', '2019-04-22', '2019-03-23', '2019-02-16',
                    '2019-01-23',
                    '2018-12-16', '2018-11-19', '2018-10-16', '2018-09-16', '2018-08-20', '2018-07-28', '2018-04-18',
                    '2018-01-27', '2017-12-17',
                    '2017-11-19', '2017-10-17', '2017-09-18', '2017-08-15', '2017-07-14', '2017-06-13', '2017-05-13',
                    '2017-04-15', '2017-03-14',
                    '2017-02-20', '2017-01-15', '2016-12-15', '2016-09-09', '2016-08-08', '2016-07-09', '2016-06-06',
                    '2016-05-06']),
        'ghent': ('belgium/vlg',
                  ['2019-07-15', '2019-06-16', '2019-05-20', '2019-04-16', '2019-03-13', '2019-02-11', '2019-01-17',
                   '2018-12-13', '2018-11-17',
                   '2018-10-12', '2018-09-14', '2018-08-18', '2018-07-22', '2018-05-19', '2018-04-15']),
        'girona': ('spain/catalonia',
                   ['2019-07-29', '2019-06-30', '2019-05-29', '2019-04-29', '2019-03-30', '2019-02-19', '2018-12-22',
                    '2018-11-26', '2018-10-20',
                    '2018-09-28', '2018-08-30', '2018-07-31', '2018-04-21']),
        'greater-manchester': ('united-kingdom/england',
                               ['2019-08-17', '2019-07-12', '2019-06-08', '2019-05-14', '2019-04-13', '2019-03-08',
                                '2019-02-07', '2019-01-14',
                                '2018-12-10', '2018-11-09', '2018-10-18', '2018-09-12', '2018-08-14', '2018-07-17',
                                '2018-05-14', '2018-04-13']),
        'london': ('united-kingdom/england',
                   ['2019-07-10', '2019-06-05', '2019-05-05', '2019-04-09', '2019-03-07', '2019-02-05', '2019-01-13',
                    '2018-12-07', '2018-11-04',
                    '2018-10-06', '2018-09-10', '2018-08-08', '2018-07-07', '2018-05-11', '2018-04-08', '2017-03-04',
                    '2016-10-03', '2016-06-02', '2016-02-02', '2015-09-02', '2015-04-06']),
        'lyon': ('france/auvergne-rhone-alpes',
                 ['2019-07-17', '2019-06-24', '2019-05-23', '2019-04-18', '2019-03-15', '2019-02-12', '2019-01-22',
                  '2018-12-15', '2018-11-18', '2018-10-16',
                  '2018-09-15', '2018-08-19', '2018-07-25', '2018-05-21', '2018-04-17']),
        'madrid': ('spain/comunidad-de-madrid',
                   ['2019-07-10', '2019-06-07', '2019-05-14', '2019-04-11', '2019-03-08', '2019-02-06', '2019-01-14',
                    '2018-12-10', '2018-11-07', '2018-10-10', '2018-09-11', '2018-08-14', '2018-07-10', '2018-05-14',
                    '2018-04-12', '2018-01-17', '2017-04-08', '2017-03-06', '2015-10-02', '2015-09-04', '2015-07-17']),
        'malaga': ('spain/andaluc%C3%ADa',
                   ['2019-09-01', '2019-07-30', '2019-06-30', '2019-05-30', '2019-05-01', '2019-03-31', '2019-02-24',
                    '2019-01-30', '2018-12-22', '2018-11-27', '2018-10-25', '2018-09-29', '2018-08-29', '2018-07-31',
                    '2018-05-27', '2018-04-22', '2017-11-25']),
        'mallorca': ('spain/islas-baleares',
                     ['2019-07-25', '2019-06-27', '2019-05-27', '2019-04-24', '2019-03-25', '2019-02-17', '2019-01-28',
                      '2018-12-18', '2018-11-20', '2018-10-17', '2018-09-18', '2018-08-21', '2018-07-29', '2018-04-18',
                      '2017-03-15', '2016-01-06']),
        'melbourne': ('australia/vic',
                      ['2019-07-09', '2019-06-04', '2019-05-11', '2019-04-08', '2019-03-07', '2019-02-04',
                       '2019-01-13', '2018-12-07', '2018-11-04',
                       '2018-10-06', '2018-09-09', '2018-08-08', '2018-07-07', '2018-05-12',
                       '2018-04-09', '2017-04-03', '2016-12-05', '2016-09-04', '2016-01-03', '2015-12-03',
                       '2015-10-02', '2015-09-03', '2015-07-18']),
        'menorca': ('spain/islas-baleares',
                    ['2019-09-01', '2019-07-30', '2019-06-30', '2019-05-30', '2019-05-01', '2019-03-31', '2019-02-24',
                     '2019-01-30', '2018-12-22', '2018-11-27', '2018-10-25', '2018-09-28', '2018-08-29', '2018-07-31',
                     '2018-04-21']),
        'milan': ('italy/lombardy',
                  ['2019-07-12', '2019-06-08', '2019-05-14', '2019-04-11', '2019-03-08', '2019-02-07', '2019-01-16',
                   '2018-12-11', '2018-11-09', '2018-10-10', '2018-09-12', '2018-08-15', '2018-07-11', '2018-06-10',
                   '2018-05-15', '2018-04-13']),
        'naples': ('italy/campania',
                   ['2019-07-12', '2019-06-08', '2019-05-14', '2019-04-11', '2019-03-08', '2019-02-07', '2019-01-16',
                    '2018-12-11', '2018-11-09', '2018-10-10', '2018-09-29', '2018-08-28', '2018-07-31', '2018-06-30']),
        'northern-rivers': ('australia/nsw',
                            [
                                '2019-09-01', '2019-07-30', '2019-06-30', '2019-05-29', '2019-05-01', '2019-03-31',
                                '2019-02-24', '2019-01-30', '2018-12-22', '2018-11-27', '2018-10-25', '2018-09-28',
                                '2018-08-29', '2018-07-31', '2018-05-29', '2018-04-22', '2016-04-02']),
        'paris': ('france/ile-de-france',
                  ['2019-07-09', '2019-06-05', '2019-05-07', '2019-04-09', '2019-03-11', '2019-02-05', '2019-01-13',
                   '2018-12-07', '2018-11-06',
                   '2018-10-09', '2018-09-10', '2018-08-13', '2018-07-08', '2018-06-07', '2018-05-11', '2018-04-10',
                   '2018-03-06',
                   #  Err  '2018-02-05',
                   '2018-01-15', '2017-12-07', '2017-11-08', '2017-10-05', '2017-09-06', '2017-08-05', '2017-07-05',
                   '2017-06-04', '2017-05-05', '2017-04-04', '2017-03-04', '2017-02-06', '2017-01-03', '2016-12-05',
                   '2016-11-04', '2016-09-03', '2016-08-04', '2016-07-03', '2016-06-02',
                   #  Err the following dates
                   # '2016-05-02', '2016-04-03', '2016-02-02', '2016-01-02', '2015-11-06', '2015-09-02',
                   #  '2015-05-06'
                   ]),
        'puglia': ('italy/puglia',
                   ['2019-07-21', '2019-06-30', '2019-05-29', '2019-04-29', '2019-03-28', '2019-02-18', '2019-01-29',
                    '2018-12-21', '2018-11-22', '2018-10-18', '2018-09-22', '2018-08-27', '2018-07-31', '2018-04-19']),
        'rome': ('italy/lazio',
                 ['2019-07-12', '2019-06-08', '2019-05-14', '2019-04-11', '2019-03-08', '2019-02-07', '2019-01-16',
                  '2018-12-11', '2018-11-09', '2018-10-10', '2018-09-12', '2018-08-15', '2018-07-11', '2018-06-10',
                  '2018-05-15', '2018-04-13', '2017-05-08']),
        # Err whole city
        'sevilla': ('spain/andaluc%C3%ADa',
                    ['2019-07-29', '2019-06-29', '2019-05-29', '2019-04-27', '2019-03-28', '2019-02-18', '2019-01-29',
                     '2018-12-21', '2018-11-22', '2018-10-18', '2018-09-22', '2018-08-27', '2018-07-31', '2018-04-21']),
        'sicily': ('italy/sicilia',
                   ['2019-07-26', '2019-06-28', '2019-05-28', '2019-04-26', '2019-03-26', '2019-02-17', '2019-01-28',
                    '2018-12-19', '2018-11-20', '2018-10-17', '2018-09-18', '2018-08-24', '2018-07-30', '2018-04-19']),
        'tasmania': ('australia/tas',
                     ['2019-08-08', '2019-07-08', '2019-06-03', '2019-05-05', '2019-04-05', '2019-03-06',
                      '2019-02-02', '2019-01-11', '2018-12-21', '2018-11-21', '2018-10-18', '2018-09-21', '2018-08-27',
                      '2018-07-31', '2018-06-26', '2018-05-26', '2018-04-21', '2018-03-31', '2018-02-17', '2018-01-30',
                      '2017-12-20', '2017-11-24', '2017-10-20', '2017-09-20', '2017-08-16', '2017-07-17', '2017-06-17',
                      '2017-05-15', '2017-04-17', '2017-03-16', '2017-02-23', '2017-01-20', '2016-12-17', '2016-11-16',
                      '2016-10-14', '2016-09-12', '2016-08-08', '2016-07-15']),
        # error whole city
        'venice': ('austria/vienna',
                   ['2019-07-10', '2019-06-07', '2019-05-11', '2019-04-10', '2019-03-08', '2019-02-06', '2019-01-13',
                    '2018-12-08', '2018-11-06', '2018-10-09', '2018-09-11', '2018-08-13', '2018-07-09', '2018-06-08',
                    '2018-05-13', '2018-04-10', '2017-05-09', '2015-07-18']),
        'vienna': ('austria/vienna',
                   ['2019-07-13', '2019-06-11', '2019-05-15', '2019-04-14', '2019-03-11', '2019-02-09', '2019-01-17',
                    '2018-12-12', '2018-11-15', '2018-10-11', '2018-09-13', '2018-08-16', '2018-07-11', '2018-06-11',
                    '2018-05-16', '2018-04-14', '2017-09-15', '2017-08-11', '2017-07-10', '2017-06-07',
                    '2017-05-09', '2017-04-09', '2017-03-08', '2017-02-14', '2017-01-08', '2016-12-10', '2016-11-09',
                    '2016-10-05', '2016-09-06', '2016-08-05', '2016-07-06', '2016-06-04', '2016-05-04', '2016-04-05',
                    '2016-02-04', '2016-01-03', '2015-11-07', '2015-07-18'])
    }


def load_to_s3():
    fs = s3fs.S3FileSystem()

    cities = cities_info()
    file_infos = ["calendar", "listings", "reviews"]
    for file_info in file_infos:
        for city in cities.keys():
            country = (cities[city][0])
            for date in cities[city][1]:
                path_template = 'http://data.insideairbnb.com/%s/%s/%s/data/%s.csv.gz' % (
                    country, city, date, file_info)
                print(path_template)
                response = requests.get(path_template)

                if response.status_code == 404:
                    print('**** error ****')
                    continue

                open('temp.csv.zip', 'wb').write(response.content)

                with open('temp.csv.zip', 'rb') as fi:
                    with gzip.GzipFile(fileobj=fi, mode='r') as zfp:
                        with fs.open('s3://airbnb-1/v2/%s/%s_%s.csv' % (file_info, city, date), 'wb') as fo:
                            for line in zfp:
                                fo.write(line)


if __name__ == "__main__":
    load_to_s3()
